<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MedTalk - Online Learning Platform{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css', v=2) }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/video-overlay.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loading.css') }}">
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Page Loader -->
    <div id="page-loader" class="page-loader active">
        <div class="loading">
            <svg width="64px" height="48px">
                <polyline points="0.157 23.954, 14 23.954, 21.843 48, 43 0, 50 24, 64 24" id="back"></polyline>
                <polyline points="0.157 23.954, 14 23.954, 21.843 48, 43 0, 50 24, 64 24" id="front"></polyline>
            </svg>
            <img src="{{ url_for('static', filename='images/medtalks-logo.png') }}" alt="MedTalks" class="loading-logo">
        </div>
    </div>

    {% include 'header.html' %}

    <main>
        {% block content %}{% endblock %}
    </main>

    {% include 'footer.html' %}

    <script src="{{ url_for('static', filename='js/loading.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header.js', v=3) }}"></script>
    <script src="{{ url_for('static', filename='js/main.js', v=3) }}"></script>
    <script src="{{ url_for('static', filename='js/scroll-animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/video-player.js') }}"></script>
    {% block extra_js %}{% endblock %}

    <!-- Google Translate Widget -->
    <div id="google_translate_element" style="display: none;"></div>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,tr,ar',
                autoDisplay: false
            }, 'google_translate_element');
        }

        function changeLanguage(lang) {
            var select = document.querySelector('.goog-te-combo');
            if (select) {
                select.value = lang;
                select.dispatchEvent(new Event('change'));

                // Double trigger for reliability (fixes Turkish issue)
                setTimeout(function () {
                    if (select.value !== lang) {
                        select.value = lang;
                        select.dispatchEvent(new Event('change'));
                    }
                }, 300);

                // Update active button state
                document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.lang-btn[onclick="changeLanguage('${lang}')"]`).classList.add('active');

                // Store preference
                localStorage.setItem('preferredLanguage', lang);
            } else {
                // If widget not loaded yet, retry after a short delay
                setTimeout(() => changeLanguage(lang), 100);
            }
        }

        // Apply saved language preference on page load (silently, during initial load)
        window.addEventListener('load', function () {
            var savedLang = localStorage.getItem('preferredLanguage');
            if (savedLang && savedLang !== 'en') {
                // Apply language after a short delay (translation happens while loader is still showing)
                setTimeout(function () {
                    var select = document.querySelector('.goog-te-combo');
                    if (select) {
                        select.value = savedLang;
                        select.dispatchEvent(new Event('change'));
                        setTimeout(function () {
                            if (select.value !== savedLang) {
                                select.value = savedLang;
                                select.dispatchEvent(new Event('change'));
                            }
                        }, 300);
                    }
                }, 500);
            }
            // Set initial active state
            var currentLang = savedLang || 'en';
            var activeBtn = document.querySelector(`.lang-btn[onclick="changeLanguage('${currentLang}')"]`);
            if (activeBtn) activeBtn.classList.add('active');
        });
    </script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>